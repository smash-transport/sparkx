<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OscarLoader &mdash; sparkx 2.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=20623aea"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
        <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
        <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
        <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
        <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            sparkx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classes/index.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sparkx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">OscarLoader</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for OscarLoader</h1><div class="highlight"><pre>
<span></span><span class="c1"># ===================================================</span>
<span class="c1">#</span>
<span class="c1">#    Copyright (c) 2024-2025</span>
<span class="c1">#      SPARKX Team</span>
<span class="c1">#</span>
<span class="c1">#    GNU General Public License (GPLv3 or later)</span>
<span class="c1">#</span>
<span class="c1"># ===================================================</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sparkx.loader.BaseLoader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sparkx.Filter</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sparkx.Particle</span><span class="w"> </span><span class="kn">import</span> <span class="n">Particle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>


<div class="viewcode-block" id="OscarLoader">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">OscarLoader</span><span class="p">(</span><span class="n">BaseLoader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OscarLoader is a class for loading and processing OSCAR format data files.</span>

<span class="sd">    This class extends the BaseLoader and provides functionality to load, filter, and process data from files in the OSCAR format. It supports different versions of the OSCAR format and allows for event-based data loading with optional filtering.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    PATH_OSCAR_ : str</span>
<span class="sd">        The path to the OSCAR data file.</span>
<span class="sd">    oscar_format_ : str</span>
<span class="sd">        The format of the OSCAR data file.</span>
<span class="sd">    optional_arguments_ : dict</span>
<span class="sd">        A dictionary of optional arguments passed to the load method.</span>
<span class="sd">    event_end_lines_ : list</span>
<span class="sd">        A list to store the end lines of events in the OSCAR data file.</span>
<span class="sd">    num_events_ : int</span>
<span class="sd">        The number of events in the OSCAR data file.</span>
<span class="sd">    num_output_per_event_ : numpy.ndarray</span>
<span class="sd">        An array containing the number of particles per event in the OSCAR data file.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    __init__(OSCAR_FILE)</span>
<span class="sd">        Initializes the OscarLoader with the provided OSCAR file path.</span>
<span class="sd">    load(**kwargs)</span>
<span class="sd">        Loads the OSCAR data with optional event ranges and filters.</span>
<span class="sd">    _get_num_skip_lines()</span>
<span class="sd">        Calculates the number of initial lines to skip in the OSCAR file.</span>
<span class="sd">    set_num_events()</span>
<span class="sd">        Sets the number of events in the OSCAR data file.</span>
<span class="sd">    set_oscar_format()</span>
<span class="sd">        Determines and sets the format of the OSCAR data file.</span>
<span class="sd">    oscar_format()</span>
<span class="sd">        Returns the OSCAR format of the data file.</span>
<span class="sd">    impact_parameter()</span>
<span class="sd">        Returns the impact parameter of the events in the OSCAR data file.</span>
<span class="sd">    event_end_lines()</span>
<span class="sd">        Returns the event end lines in the OSCAR data file.</span>
<span class="sd">    __get_num_read_lines()</span>
<span class="sd">        Calculates the number of lines to read based on the specified events.</span>
<span class="sd">    __apply_kwargs_filters(event, filters_dict)</span>
<span class="sd">        Applies filters to the event data based on the provided filter dictionary.</span>
<span class="sd">    set_particle_list(kwargs)</span>
<span class="sd">        Sets the list of particles from the OSCAR data file.</span>
<span class="sd">    set_num_output_per_event_and_event_footers()</span>
<span class="sd">        Determines the number of output lines per event and the event footers in the OSCAR data file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PATH_OSCAR_</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">oscar_format_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">optional_arguments_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">event_end_lines_</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">num_events_</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_output_per_event_</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">custom_attr_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OSCAR_FILE</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for the OscarLoader class.</span>

<span class="sd">        This method initializes an instance of the OscarLoader class. It checks if the provided file is in the OSCAR format (i.e., it has the &#39;.oscar&#39; extension). If not, it raises a FileNotFoundError.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        OSCAR_FILE : str</span>
<span class="sd">            The path to the OSCAR data file.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">            If the input file does not have the &#39;.oscar&#39; or &#39;.dat&#39; extension.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;.oscar&quot;</span> <span class="ow">in</span> <span class="n">OSCAR_FILE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;.dat&quot;</span> <span class="ow">in</span> <span class="n">OSCAR_FILE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;Input file is not in the OSCAR format. Input &quot;</span>
                <span class="s2">&quot;file must have the ending .oscar or .dat&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PATH_OSCAR_</span> <span class="o">=</span> <span class="n">OSCAR_FILE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="OscarLoader.load">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.load">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Particle</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the OSCAR data from the specified file.</span>

<span class="sd">        This method accepts optional arguments that specify which events to load and any filters to apply. The &#39;events&#39; argument can be either a tuple specifying a range of events or an integer specifying a single event. If the &#39;events&#39; argument is provided and is not a tuple or an integer, or if any of the event numbers are negative, a ValueError is raised.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            A dictionary of optional arguments. The following keys are recognized:</span>

<span class="sd">            - &#39;events&#39;: Either a tuple of two integers specifying the range of events to load, or a single integer specifying a single event to load.</span>
<span class="sd">            - &#39;filters&#39;: A list of filters to apply to the data.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If an unrecognized keyword argument is used in the constructor, or if the &#39;events&#39; argument is not a tuple or an integer, or if any of the event numbers are negative.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            A tuple containing the following elements:</span>

<span class="sd">            - A list of particles loaded from the OSCAR data.</span>
<span class="sd">            - The number of events in the OSCAR data.</span>
<span class="sd">            - The number of particles in each event in the OSCAR data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_end_lines_</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="s2">&quot;filters&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown keyword argument used in constructor&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;events&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">tuple</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_that_tuple_contains_integers_only</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;First value of event number tuple must be smaller than second value&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Event numbers must be non-negative&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;events&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">int</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Event number must be non-negative&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_oscar_format</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_num_events</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_num_output_per_event_and_event_footers</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_particle_list</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_num_skip_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get number of initial lines in Oscar file that are header or comment</span>
<span class="sd">        lines and need to be skipped in order to read the particle output.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        skip_lines : int</span>
<span class="sd">            Number of initial lines before data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span>
            <span class="ow">or</span> <span class="s2">&quot;events&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">skip_lines</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">skip_lines</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cumulate_lines</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]):</span>
                    <span class="n">cumulate_lines</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">skip_lines</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">cumulate_lines</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">line_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line_start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">skip_lines</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cumulate_lines</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_start</span><span class="p">):</span>
                    <span class="n">cumulate_lines</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">skip_lines</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">cumulate_lines</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;Value given as flag &quot;events&quot; is not of type &#39;</span>
                <span class="o">+</span> <span class="s2">&quot;int or a tuple of two int values&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">skip_lines</span>

<div class="viewcode-block" id="OscarLoader.set_num_events">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.set_num_events">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_num_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the number of events in the OSCAR data file.</span>

<span class="sd">        This method reads the file in binary mode to search for the last line. This approach avoids the need to loop through the entire file, which can be time-consuming for large files. It then checks if the last line starts with a &#39;#&#39; and contains the word &#39;event&#39;. If it does, it sets the number of events to the integer value in the third position of the last line. If the last line does not meet these conditions, it raises a TypeError.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the last line of the file does not start with a &#39;#&#39; and contain the word &#39;event&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PATH_OSCAR_</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">)</span>
            <span class="n">last_line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span> <span class="ow">and</span> <span class="s2">&quot;event&quot;</span> <span class="ow">in</span> <span class="n">last_line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">BaseLoader</span><span class="o">.</span><span class="n">_extract_integer_after_keyword</span><span class="p">(</span><span class="n">last_line</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Input file does not end with a comment line &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;including the events. File might be incomplete &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;or corrupted.&quot;</span>
            <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_custom_attr_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_line</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">attr_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;mass&quot;</span><span class="p">,</span>
            <span class="s2">&quot;p0&quot;</span><span class="p">:</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span>
            <span class="s2">&quot;px&quot;</span><span class="p">:</span> <span class="s2">&quot;px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;py&quot;</span><span class="p">:</span> <span class="s2">&quot;py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pz&quot;</span><span class="p">:</span> <span class="s2">&quot;pz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pdg&quot;</span><span class="p">:</span> <span class="s2">&quot;pdg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ncoll&quot;</span><span class="p">:</span> <span class="s2">&quot;ncoll&quot;</span><span class="p">,</span>
            <span class="s2">&quot;form_time&quot;</span><span class="p">:</span> <span class="s2">&quot;form_time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xsecfac&quot;</span><span class="p">:</span> <span class="s2">&quot;xsecfac&quot;</span><span class="p">,</span>
            <span class="s2">&quot;proc_id_origin&quot;</span><span class="p">:</span> <span class="s2">&quot;proc_id_origin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;proc_type_origin&quot;</span><span class="p">:</span> <span class="s2">&quot;proc_type_origin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_last_coll&quot;</span><span class="p">:</span> <span class="s2">&quot;time_last_coll&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pdg_mother1&quot;</span><span class="p">:</span> <span class="s2">&quot;pdg_mother1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pdg_mother2&quot;</span><span class="p">:</span> <span class="s2">&quot;pdg_mother2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;baryon_number&quot;</span><span class="p">:</span> <span class="s2">&quot;baryon_number&quot;</span><span class="p">,</span>
            <span class="s2">&quot;strangeness&quot;</span><span class="p">:</span> <span class="s2">&quot;strangeness&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_line</span><span class="p">)):</span>
            <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attr_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">header_line</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span>

<div class="viewcode-block" id="OscarLoader.set_oscar_format">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.set_oscar_format">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_oscar_format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the number of events in the OSCAR data file.</span>

<span class="sd">        This method reads the file in binary mode to search for the last line. This approach avoids the need to loop through the entire file, which can be time-consuming for large files. It then checks if the last line starts with a &#39;#&#39; and contains the word &#39;event&#39;. If it does, it sets the number of events to the integer value in the third position of the last line. If the last line does not meet these conditions, it raises a TypeError.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the last line of the file does not start with a &#39;#&#39; and contain the word &#39;event&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PATH_OSCAR_</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">first_line_list</span> <span class="o">=</span> <span class="n">first_line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_line_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span> <span class="ow">or</span> <span class="n">first_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#!OSCAR2013&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">=</span> <span class="s2">&quot;Oscar2013&quot;</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">first_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#!OSCAR2013Extended&quot;</span>
            <span class="ow">and</span> <span class="n">first_line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SMASH_IC&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">=</span> <span class="s2">&quot;Oscar2013Extended_IC&quot;</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">first_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#!OSCAR2013Extended&quot;</span>
            <span class="ow">and</span> <span class="n">first_line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Photons&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">=</span> <span class="s2">&quot;Oscar2013Extended_Photons&quot;</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">first_line_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">23</span>
            <span class="ow">or</span> <span class="n">first_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#!OSCAR2013Extended&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">=</span> <span class="s2">&quot;Oscar2013Extended&quot;</span>
        <span class="k">elif</span> <span class="n">first_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#!ASCII&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">=</span> <span class="s2">&quot;ASCII&quot;</span>
            <span class="n">value_line</span> <span class="o">=</span> <span class="n">first_line_list</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_custom_attr_list</span><span class="p">(</span><span class="n">value_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Input file must follow the Oscar2013, &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Oscar2013Extended, Oscar2013Extended_IC, Oscar2013Extended_Photons or ASCII format. &quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="OscarLoader.oscar_format">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.oscar_format">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">oscar_format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the OSCAR format string.</span>

<span class="sd">        This method returns the OSCAR format string that specifies the format</span>
<span class="sd">        of the OSCAR data being loaded.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[str]</span>
<span class="sd">            The OSCAR format string, or None if the format is not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span></div>


<div class="viewcode-block" id="OscarLoader.event_end_lines">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.event_end_lines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">event_end_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of event end lines.</span>

<span class="sd">        This method returns the list of strings that mark the end of events</span>
<span class="sd">        in the OSCAR data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">            A list of strings that mark the end of events in the OSCAR data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_end_lines_</span></div>


<div class="viewcode-block" id="OscarLoader.impact_parameter">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.impact_parameter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">impact_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the impact parameter of the events.</span>

<span class="sd">        This method extracts the impact parameter of the collision from the</span>
<span class="sd">        last line of each event in the OSCAR data file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">            The impact parameter of the collisions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">impact_parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_end_lines_</span><span class="p">:</span>
            <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">line_split</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_split</span><span class="p">))</span>
            <span class="n">impact_parameter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">impact_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">impact_parameter</span><span class="p">)</span>

        <span class="c1"># update the list with the num_output_per_event_ for the case</span>
        <span class="c1"># that only certain events are loaded from the file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">impact_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">impact_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">impact_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_list</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">impact_parameters</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__get_num_read_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the number of lines to read from the OSCAR data file.</span>

<span class="sd">        This method determines the number of lines to read based on the &#39;events&#39; key in the optional arguments. If &#39;events&#39; is not specified, it sums the number of output lines for all events. If &#39;events&#39; is an integer, it gets the number of output lines for the specified event. If &#39;events&#39; is a tuple, it sums the number of output lines for the range of events specified. If &#39;events&#39; is not an integer or a tuple, it raises a TypeError.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the value given as flag events is not of type int or a tuple.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cumulated_lines : int</span>
<span class="sd">            The total number of lines to read from the OSCAR data file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span>
            <span class="ow">or</span> <span class="s2">&quot;events&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">cumulated_lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># add number of comments</span>
            <span class="n">cumulated_lines</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">read_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
            <span class="n">cumulated_lines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="n">read_event</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">cumulated_lines</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">event_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">event_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">event_start</span><span class="p">,</span> <span class="n">event_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">cumulated_lines</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Value given as flag events is not of type int or a tuple&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">cumulated_lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__apply_kwargs_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Particle</span><span class="p">]],</span> <span class="n">filters_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Particle</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the specified filters to the given event.</span>

<span class="sd">        This method applies a series of filters to the event data based on the</span>
<span class="sd">        keys in the filters_dict dictionary. The filters include:</span>
<span class="sd">        &#39;charged_particles&#39;, &#39;uncharged_particles&#39;,</span>
<span class="sd">        &#39;particle_species&#39;, &#39;remove_particle_species&#39;, &#39;participants&#39;,</span>
<span class="sd">        &#39;spectators&#39;, &#39;lower_event_energy_cut&#39;, &#39;spacetime_cut&#39;, &#39;pT_cut&#39;,</span>
<span class="sd">        &#39;mT_cut&#39;, &#39;rapidity_cut&#39;, &#39;pseudorapidity_cut&#39;,</span>
<span class="sd">        &#39;spacetime_rapidity_cut&#39;, &#39;multiplicity_cut&#39;, &#39;keep_hadrons&#39;,</span>
<span class="sd">        &#39;keep_leptons&#39;, &#39;keep_mesons&#39;, &#39;keep_baryons&#39;, &#39;keep_up&#39;, &#39;keep_down&#39;,</span>
<span class="sd">        &#39;keep_strange&#39;, &#39;keep_charm&#39;, &#39;keep_bottom&#39;, &#39;keep_top&#39; and</span>
<span class="sd">        &#39;remove_photons&#39;.</span>
<span class="sd">        If a key in the filters_dict dictionary does not</span>
<span class="sd">        match any of these filters, a ValueError is raised.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : list</span>
<span class="sd">            The event data to be filtered.</span>
<span class="sd">        filters_dict : dict</span>
<span class="sd">            A dictionary of filters to apply to the event data. The keys of the</span>
<span class="sd">            dictionary specify the filters to apply, and the values specify the</span>
<span class="sd">            parameters for the filters.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a key in the filters_dict dictionary does not match any of the</span>
<span class="sd">            supported filters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        event : list</span>
<span class="sd">            The filtered event data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">event</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filters_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;charged_particles&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;charged_particles&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">charged_particles</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;uncharged_particles&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;uncharged_particles&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">uncharged_particles</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;particle_species&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">particle_species</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;particle_species&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;remove_particle_species&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">remove_particle_species</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;remove_particle_species&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;participants&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">participants</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;spectators&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;spectators&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">spectators</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;lower_event_energy_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">lower_event_energy_cut</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;lower_event_energy_cut&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;spacetime_cut&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;spacetime_cut&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The spacetime cut filter requires a list of two values.&quot;</span>
                    <span class="p">)</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">spacetime_cut</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span>
                    <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;spacetime_cut&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;spacetime_cut&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;pT_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">pT_cut</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;pT_cut&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;mT_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">mT_cut</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;mT_cut&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;rapidity_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">rapidity_cut</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;rapidity_cut&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;pseudorapidity_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">pseudorapidity_cut</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;pseudorapidity_cut&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;spacetime_rapidity_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">spacetime_rapidity_cut</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;spacetime_rapidity_cut&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;multiplicity_cut&quot;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">multiplicity_cut</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;multiplicity_cut&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_hadrons&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_hadrons&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_hadrons</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_leptons&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_leptons&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_leptons</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_mesons&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_mesons&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_mesons</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_baryons&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_baryons&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_baryons</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_up&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_up&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_up</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_down&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_down&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_down</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_strange&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_strange&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_strange</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_charm&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_charm&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_charm</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_bottom&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_bottom&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_bottom</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;keep_top&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;keep_top&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">keep_top</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;remove_photons&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filters_dict</span><span class="p">[</span><span class="s2">&quot;remove_photons&quot;</span><span class="p">]:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">remove_photons</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The cut is unknown!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">event</span>

<div class="viewcode-block" id="OscarLoader.set_particle_list">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.set_particle_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_particle_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Particle</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the list of particles from the OSCAR data file.</span>

<span class="sd">        This method reads the OSCAR data file line by line and creates a list</span>
<span class="sd">        of Particle objects. It also applies any filters specified in the</span>
<span class="sd">        &#39;filters&#39; key of the kwargs dictionary. If the &#39;events&#39; key is</span>
<span class="sd">        specified in the kwargs dictionary, it adjusts the number of events and</span>
<span class="sd">        the number of output lines per event accordingly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            A dictionary of optional arguments. The following keys are recognized:</span>

<span class="sd">            - &#39;events&#39;: Either a tuple of two integers specifying the range of events to load, or a single integer specifying a single event to load.</span>
<span class="sd">            - &#39;filters&#39;: A list of filters to apply to the data.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IndexError</span>
<span class="sd">            If the number of events in the OSCAR file does not match the number</span>
<span class="sd">            of events specified by the comments in the OSCAR file, or if the</span>
<span class="sd">            index is out of range of the OSCAR file.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the first line of the event is not a comment line or does not</span>
<span class="sd">            contain &quot;out&quot;, or if a comment line is unexpectedly found.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        particle_list : list</span>
<span class="sd">            A list of Particle objects loaded from the OSCAR data file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">particle_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Particle</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Particle</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num_read_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_num_read_lines</span><span class="p">()</span>
        <span class="n">cut_events</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PATH_OSCAR_</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">oscar_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_lines</span><span class="p">(</span><span class="n">oscar_file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_read_lines</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">oscar_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                        <span class="s2">&quot;Index out of range of OSCAR file. This most likely happened because &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;the particle number specified by the comments in the OSCAR &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;file differs from the actual number of particles in the event.&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;#&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot;out&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;First line of the event is not a comment &quot;</span>
                        <span class="o">+</span> <span class="s1">&#39;line or does not contain &quot;out&quot;&#39;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;event&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;in &quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot; start&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot;end&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">old_data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;filters&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__apply_kwargs_filters</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">data</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span>
                        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">old_data_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particle_list</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="nb">len</span><span class="p">(</span><span class="n">particle_list</span><span class="p">),</span>
                                <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">,</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="n">particle_list</span><span class="p">),</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                            <span class="k">elif</span> <span class="p">(</span>
                                <span class="nb">len</span><span class="p">(</span><span class="n">particle_list</span><span class="p">)</span>
                                <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="n">particle_list</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span>
                                <span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">old_data_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">particle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cut_events</span> <span class="o">=</span> <span class="n">cut_events</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Comment line unexpectedly found: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">==</span> <span class="s2">&quot;ASCII&quot;</span><span class="p">:</span>
                        <span class="n">particle</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr_list</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">particle</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span><span class="p">,</span> <span class="n">line_list</span><span class="p">)</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">particle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span> <span class="o">-</span> <span class="n">cut_events</span>
        <span class="c1"># Correct num_output_per_event and num_events</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s2">&quot;events&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_arguments_</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">particle_list</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="s2">&quot;Number of events in OSCAR file does not match the &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;number of events specified by the comments in the &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;OSCAR file!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">update</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">event_start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">event_end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span><span class="p">[</span><span class="n">event_start</span> <span class="p">:</span> <span class="n">event_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span> <span class="o">=</span> <span class="n">update</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_events_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">event_end</span> <span class="o">-</span> <span class="n">event_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">particle_list</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">particle_list</span> <span class="o">=</span> <span class="p">[[]]</span>

        <span class="k">return</span> <span class="n">particle_list</span></div>


<div class="viewcode-block" id="OscarLoader.set_num_output_per_event_and_event_footers">
<a class="viewcode-back" href="../classes/loader/OscarLoader/index.html#OscarLoader.OscarLoader.set_num_output_per_event_and_event_footers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_num_output_per_event_and_event_footers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the number of output lines per event and the event footers in the</span>
<span class="sd">        OSCAR data file.</span>

<span class="sd">        This method reads the OSCAR data file line by line and determines the</span>
<span class="sd">        number of output lines for each event and the event footers. The method</span>
<span class="sd">        behaves differently depending on the OSCAR format of the data file.</span>
<span class="sd">        If the format is &#39;Oscar2013Extended_IC&#39; or &#39;Oscar2013Extended_Photons&#39;,</span>
<span class="sd">        it counts the number of lines between &#39;in&#39; and &#39;end&#39; lines. Otherwise,</span>
<span class="sd">        it counts the number of lines between &#39;out&#39; and &#39;end&#39; lines.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PATH_OSCAR_</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">oscar_file</span><span class="p">:</span>
            <span class="n">line_counter</span><span class="p">:</span> <span class="nb">int</span>
            <span class="n">event</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
            <span class="n">line_str</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">!=</span> <span class="s2">&quot;Oscar2013Extended_IC&quot;</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">!=</span> <span class="s2">&quot;Oscar2013Extended_Photons&quot;</span>
            <span class="p">):</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">oscar_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot; end &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">event_end_lines_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot; out &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">line_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">event</span> <span class="o">=</span> <span class="n">BaseLoader</span><span class="o">.</span><span class="n">_extract_integer_after_keyword</span><span class="p">(</span>
                            <span class="n">line_str</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span>
                        <span class="p">)</span>
                        <span class="n">num_output</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">BaseLoader</span><span class="o">.</span><span class="n">_extract_integer_after_keyword</span><span class="p">(</span>
                                <span class="n">line_str</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">event_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">event</span><span class="p">,</span> <span class="n">num_output</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">==</span> <span class="s2">&quot;Oscar2013Extended_IC&quot;</span><span class="p">:</span>
                <span class="n">line_counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">event</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">line_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">oscar_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot; end&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">event_end_lines_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">event_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">event</span><span class="p">,</span> <span class="n">line_counter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot; in &quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot; start&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">line_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">event</span> <span class="o">=</span> <span class="n">BaseLoader</span><span class="o">.</span><span class="n">_extract_integer_after_keyword</span><span class="p">(</span>
                            <span class="n">line_str</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span>
                        <span class="p">)</span>
                        <span class="n">line_counter</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscar_format_</span> <span class="o">==</span> <span class="s2">&quot;Oscar2013Extended_Photons&quot;</span><span class="p">:</span>
                <span class="n">line_counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">event</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">line_memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">line_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line_memory</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">oscar_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot; end &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line_memory</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">event_end_lines_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">line_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">event</span> <span class="o">=</span> <span class="n">BaseLoader</span><span class="o">.</span><span class="n">_extract_integer_after_keyword</span><span class="p">(</span>
                            <span class="n">line_str</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span>
                        <span class="p">)</span>
                        <span class="n">event_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">event</span><span class="p">,</span> <span class="n">line_counter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot; out &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">line_counter</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_output_per_event_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">event_output</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SPARKX Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>